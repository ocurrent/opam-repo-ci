build: debian-12-ocaml-4.02/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.02/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.03/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.03/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.04/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.04/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.05/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.05/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.06/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.06/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.07/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.07/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.08/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.08/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.09/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.09/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.10/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.10/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.11/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.11/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.12/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.12/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.13/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.13/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

list-revdeps: debian-12-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN echo '@@@OUTPUT' && opam list -s --color=never --depends-on 'a.0.0.1' --coinstallable-with 'a.0.0.1' --all-versions --depopts && opam list -s --color=never --depends-on 'a.0.0.1' --coinstallable-with 'a.0.0.1' --all-versions --recursive && opam list -s --color=never --depends-on 'a.0.0.1' --coinstallable-with 'a.0.0.1' --all-versions --with-test --depopts && echo '@@@OUTPUT'

build: debian-12-ocaml-4.14/amd64 opam-dev with-tests
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    RUN opam option solver=builtin-0install
    RUN (opam reinstall --with-test a.0.0.1) || true
    RUN opam reinstall --with-test --verbose a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.0/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.0/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.1/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.1/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/amd64 opam-dev lower-bounds
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    ENV OPAMCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMFIXUPCRITERIA="+removed,+count[version-lag,solution]"
    ENV OPAMUPGRADECRITERIA="+removed,+count[version-lag,solution]"
    RUN opam option solver=builtin-0install
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

list-revdeps: debian-12-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN echo '@@@OUTPUT' && opam list -s --color=never --depends-on 'a.0.0.1' --coinstallable-with 'a.0.0.1' --all-versions --depopts && opam list -s --color=never --depends-on 'a.0.0.1' --coinstallable-with 'a.0.0.1' --all-versions --recursive && opam list -s --color=never --depends-on 'a.0.0.1' --coinstallable-with 'a.0.0.1' --all-versions --with-test --depopts && echo '@@@OUTPUT'

build: debian-12-ocaml-5.2/amd64 opam-dev with-tests
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1
    RUN opam option solver=builtin-0install
    RUN (opam reinstall --with-test a.0.0.1) || true
    RUN opam reinstall --with-test --verbose a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-24.04-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-24.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-22.04-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-22.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-20.04-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-20.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: opensuse-tumbleweed-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"opensuse-tumbleweed\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: opensuse-15.6-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"opensuse-15.6\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: fedora-40-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"fedora-40\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: fedora-39-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"fedora-39\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-unstable-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-unstable\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-testing-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-testing\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-11-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-11\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: archlinux-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"archlinux\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: alpine-3.20-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"alpine-3.20\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-24.04-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-24.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-22.04-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-22.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-20.04-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-20.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: opensuse-tumbleweed-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"opensuse-tumbleweed\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: opensuse-15.6-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"opensuse-15.6\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: fedora-40-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"fedora-40\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: fedora-39-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"fedora-39\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-unstable-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-unstable\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-testing-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-testing\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-11-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-11\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: archlinux-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"archlinux\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: alpine-3.20-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"alpine-3.20\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: macos-homebrew-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    RUN ln -f ~/local/bin/opam-dev ~/local/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url -k local --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/Users/mac1000/.opam/download-cache,uid=1000 --mount=type=cache,id=homebrew,target=/Users/mac1000/Library/Caches/Homebrew,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"macos-homebrew\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: macos-homebrew-ocaml-5.2/arm64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    RUN ln -f ~/local/bin/opam-dev ~/local/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url -k local --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/Users/mac1000/.opam/download-cache,uid=1000 --mount=type=cache,id=homebrew,target=/Users/mac1000/Library/Caches/Homebrew,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"macos-homebrew\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: macos-homebrew-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    RUN ln -f ~/local/bin/opam-dev ~/local/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url -k local --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/Users/mac1000/.opam/download-cache,uid=1000 --mount=type=cache,id=homebrew,target=/Users/mac1000/Library/Caches/Homebrew,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"macos-homebrew\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: macos-homebrew-ocaml-4.14/arm64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    RUN ln -f ~/local/bin/opam-dev ~/local/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url -k local --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/Users/mac1000/.opam/download-cache,uid=1000 --mount=type=cache,id=homebrew,target=/Users/mac1000/Library/Caches/Homebrew,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"macos-homebrew\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: freebsd-ocaml-5.2/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/local/bin/opam-dev /usr/local/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"freebsd\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: freebsd-ocaml-4.14/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/local/bin/opam-dev /usr/local/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"freebsd\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/amd64 opam-2.0
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-2.0 /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam depext -u || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam depext a.0.0.1 && opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/amd64 opam-2.1
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-2.1 /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/amd64 opam-2.2
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-2.2 /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2-afl/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2-flambda/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2-no-flat-float-array/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/i386 opam-dev
    FROM BASE_IMAGE_TAG
    SHELL [ "/usr/bin/linux32", "/bin/sh", "-c" ]
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/arm64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/ppc64le opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/arm32v7 opam-dev
    FROM BASE_IMAGE_TAG
    SHELL [ "/usr/bin/linux32", "/bin/sh", "-c" ]
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-5.2/s390x opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-24.04-ocaml-5.2/riscv64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-24.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/amd64 opam-2.0
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-2.0 /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam depext -u || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam depext a.0.0.1 && opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/amd64 opam-2.1
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-2.1 /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/amd64 opam-2.2
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-2.2 /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14-afl/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14-flambda/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14-fp/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14-flambda-fp/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14-no-flat-float-array/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14-nnp/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14-nnpchecker/amd64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/i386 opam-dev
    FROM BASE_IMAGE_TAG
    SHELL [ "/usr/bin/linux32", "/bin/sh", "-c" ]
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/arm64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/ppc64le opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/arm32v7 opam-dev
    FROM BASE_IMAGE_TAG
    SHELL [ "/usr/bin/linux32", "/bin/sh", "-c" ]
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: debian-12-ocaml-4.14/s390x opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"debian-12\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

build: ubuntu-24.04-ocaml-4.14/riscv64 opam-dev
    FROM BASE_IMAGE_TAG
    USER 1000:1000
    WORKDIR /home/opam
    RUN sudo ln -f /usr/bin/opam-dev /usr/bin/opam
    RUN opam init --reinit -ni
    RUN uname -rs && opam exec -- ocaml -version && opam --version
    ENV OPAMDOWNLOADJOBS="1"
    ENV OPAMERRLOGLEN="0"
    ENV OPAMSOLVERTIMEOUT="500"
    ENV OPAMPRECISETRACKING="1"
    ENV CI="true"
    ENV OPAM_REPO_CI="true"
    RUN rm -rf opam-repository/
    COPY --chown=1000:1000 . opam-repository/
    RUN opam repository set-url --strict default opam-repository/
    RUN opam update --depexts || true
    RUN opam pin add -k version -yn a.0.0.1 0.0.1
    RUN --mount=type=cache,id=opam-archives,target=/home/opam/.opam/download-cache,uid=1000 opam reinstall a.0.0.1; \
        res=$?; \
        test "$res" != 31 && exit "$res"; \
        export OPAMCLI=2.0; \
        build_dir=$(opam var prefix)/.opam-switch/build; \
        failed=$(ls "$build_dir"); \
        partial_fails=""; \
        for pkg in $failed; do \
        if opam show -f x-ci-accept-failures: "$pkg" | grep -qF "\"ubuntu-24.04\""; then \
        echo "A package failed and has been disabled for CI using the 'x-ci-accept-failures' field."; \
        fi; \
        test "$pkg" != 'a.0.0.1' && partial_fails="$partial_fails $pkg"; \
        done; \
        test "${partial_fails}" != "" && echo "opam-repo-ci detected dependencies failing: ${partial_fails}"; \
        exit 1

